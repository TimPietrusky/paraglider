<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/presets/data-wrapper.js | Paraglider API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  <a href="./manual/index.html" data-ice="manualHeaderLink">Manual</a>
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/pixelass/paraglider" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-parseObject">parseObject</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-preventDefault">preventDefault</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-PLUGIN_DEFAULTS">PLUGIN_DEFAULTS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-PRESET_DEFAULTS">PRESET_DEFAULTS</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">glider</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/glider/index.js~Glider.html">Glider</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-callbackData">callbackData</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-onDestroy">onDestroy</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-onEnd">onEnd</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-onInit">onInit</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-onSlide">onSlide</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">presets</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-belt">belt</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-coverLeftRight">coverLeftRight</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-coverLeft">coverLeft</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-coverRight">coverRight</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-dataWrapper">dataWrapper</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-multiBelt">multiBelt</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-multiWrapper">multiWrapper</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-wrapper">wrapper</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/presets/data-wrapper.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">/* global document */
/**
 * @file presets/data-wrapper.js
 * @module  presets
 * @author Gregor Adams &lt;greg@pixelass.com&gt;
 */
import Glider from &apos;../glider&apos;
import {PLUGIN_DEFAULTS} from &apos;../config&apos;
import {
  findAll as $,
  findFirst as $$,
  parseObject,
  preventDefault
} from &apos;../helpers&apos;

const classNames = {
  pager: &apos;pager&apos;,
  dot: &apos;dot&apos;,
  active: &apos;active&apos;,
  previousButton: &apos;previousButton&apos;,
  nextButton: &apos;nextButton&apos;,
  disabled: &apos;disabled&apos;,
  dragging: &apos;dragging&apos;,
  draggable: &apos;draggable&apos;,
  caption: &apos;caption&apos;,
  headline: &apos;headline&apos;,
  subline: &apos;subline&apos;,
  description: &apos;description&apos;
}

/**
 * Defaults for the data wrapper
 * @private
 * @type {object}
 */
const DATA_DEFAULTS = {
  PLUGIN_DEFAULTS,
  classNames: {
    ...PLUGIN_DEFAULTS.classNames,
    ...classNames
  }
}

const {documentElement} = document

/**
 * Autorunner. Continiously loops play. Disables when interacting or hovering
 * @param {Element} el
 * @param {contructor} instance
 * @param {number} duration
 * @param {number} rewind
 */
const autoRunner = (el, instance, duration, rewind) =&gt; {
  let running = true
  let down
  let inside
  let timer
  let runHandler
  let slideCount
  const autoplay = run =&gt; {
    global.requestAnimationFrame(run)
    return run
  }
  const runner = wait =&gt; {
    if (running) {
      timer = setTimeout(runner, duration)
      if (!wait) {
        if (slideCount === rewind) {
          slideCount = instance.goTo(0)
        } else {
          slideCount = instance.nextSlide()
        }
      }
    } else {
      timer = clearTimeout(timer)
    }
  }
  // Defines a waiting runner.
  // Does not trigger but calls the timeout
  const waitingRunner = () =&gt; runner(true)

  el.addEventListener(&apos;mouseenter&apos;, () =&gt; {
    running = false
    inside = true
    global.cancelAnimationFrame(runHandler)
    timer = clearTimeout(timer)
  })

  el.addEventListener(&apos;mousedown&apos;, () =&gt; {
    running = false
    down = true
    inside = true
    global.cancelAnimationFrame(runHandler)
    timer = clearTimeout(timer)
  })

  el.addEventListener(&apos;mousemove&apos;, () =&gt; {
    running = false
    inside = true
    global.cancelAnimationFrame(runHandler)
    timer = clearTimeout(timer)
  })

  el.addEventListener(&apos;mouseleave&apos;, () =&gt; {
    inside = false
    if (!down) {
      running = true
      runHandler = autoplay(waitingRunner)
    }
  })

  document.addEventListener(&apos;mouseup&apos;, () =&gt; {
    if (down &amp;&amp; !inside) {
      running = true
      runHandler = autoplay(waitingRunner)
    }
    down = false
  })

  document.addEventListener(&apos;visibilitychange&apos;, e =&gt; {
    const {hidden} = e.target
    if (hidden) {
      running = false
      global.cancelAnimationFrame(runHandler)
      timer = clearTimeout(timer)
    } else {
      running = true
      runHandler = autoplay(waitingRunner)
    }
  })
  // The first handler waits
  runHandler = autoplay(waitingRunner)
}

/**
 * Wraps Paraglider to apply pagers and navigation buttons and autoplay.
 * This wrapper simplifies the usage of Paraglider by offering some basic
 * functionality.
 * Data attributes are used to configure the plugin.
 * @param {Element} glider
 * @param {DATA_DEFAULTS} opts
 * @returns {function} returns the destroy method
 */
const dataWrapper = (glider, opts) =&gt; {
  // Get options from data attributes
  const data = parseObject(glider.dataset)
  // Find draggable elements to disable dragstart
  // This prevents images and anchors from affecting swiping
  const draggables = [
    ...$(&apos;img&apos;, glider),
    ...$(&apos;a&apos;, glider)
  ]
  const {
    pager,
    dot,
    nextButton,
    previousButton,
    caption,
    headline,
    subline,
    description
  } = opts.classNames
  // Elements potentially used by the wrapper
  const pagers = $(`.${pager}`, glider)
  const nextTrigger = $$(`.${nextButton}`, glider)
  const prevTrigger = $$(`.${previousButton}`, glider)
  // Get elements from context
  const dots = pagers.map(el =&gt; $$(`.${dot}`, el))
  const captions = $(`.${caption}`, glider)
  const headlines = captions.map(l =&gt; $$(`.${headline}`, l))
  const sublines = captions.map(l =&gt; $$(`.${subline}`, l))
  const descriptions = captions.map(l =&gt; $$(`.${description}`, l))
  // Flag do determine in clicks are allowed or blocked
  let block
  // Ensure instance identifier
  let instance = null
  // Collect handlers.
  // Allows removing them when destroying
  const pagerHandlers = []
  /**
   * Handle the previous button
   * @param {event} e
   */
  const handlePrev = e =&gt; {
    if (block) {
      preventDefault(e)
    } else {
      block = true
      if (instance) {
        instance.prevSlide(e)
      }
    }
  }
  /**
   * Handle the next button
   * @param {event} e
   */
  const handleNext = e =&gt; {
    if (block) {
      preventDefault(e)
    } else {
      block = true
      if (instance) {
        instance.nextSlide(e)
      }
    }
  }
  /**
   * Handle mousedown
   * Adds dragging class name
   */
  const handleMouseDown = () =&gt; documentElement.classList.add(opts.classNames.dragging)
  /**
   * Handle mouseup
   * Removes dragging class name
   */
  const handleMouseUp = () =&gt; documentElement.classList.remove(opts.classNames.dragging)
  /**
   * Paraglider instance
   *
   * A paraglider with several options.
   */
  instance = new Glider({
    ...DATA_DEFAULTS,
    ...opts,
    ...data,
    classNames: {...DATA_DEFAULTS.classNames, ...opts.classNames},
    onInit({previous, next, current, rest}, slides, options) {
      draggables.forEach(draggable =&gt; {
        draggable.addEventListener(&apos;dragstart&apos;, preventDefault)
      })
      if (options.autoplay) {
        autoRunner(glider, instance, options.autoplay, options.loop ? false : slides.length - 1)
      }
      pagers.forEach((pager, index) =&gt; {
        const handler = e =&gt; {
          preventDefault(e)
          if (!block) {
            block = true
            if (instance) {
              instance.goTo(index)
            }
          }
        }
        pager.addEventListener(&apos;click&apos;, handler)
        pagerHandlers.push(handler)
      })
      if (nextTrigger) {
        nextTrigger.addEventListener(&apos;click&apos;, handleNext)
      }
      if (prevTrigger) {
        prevTrigger.addEventListener(&apos;click&apos;, handlePrev)
      }
      if (options.enableSwipe !== 0) {
        slides.forEach(el =&gt; {
          el.classList.add(options.classNames.draggable)
          el.addEventListener(&apos;mousedown&apos;, handleMouseDown)
        })
      }
      document.addEventListener(&apos;mouseup&apos;, handleMouseUp)
      if (pagers[current]) {
        pagers[current].classList.add(options.classNames.active)
      }
      if (!options.loop &amp;&amp; prevTrigger &amp;&amp; nextTrigger) {
        if ((current === 0) &amp;&amp; prevTrigger &amp;&amp; nextTrigger) {
          prevTrigger.classList.add(options.classNames.disabled)
        } else if (current === (slides.length - 1)) {
          nextTrigger.classList.add(options.classNames.disabled)
        }
      }
      if (typeof opts.onInit === &apos;function&apos;) {
        opts.onInit({previous, next, current, rest}, {
          slides,
          captions,
          headlines,
          sublines,
          descriptions,
          pagers,
          dots,
          nextTrigger,
          prevTrigger
        }, options)
      }
    },
    onEnd({previous, next, current, rest}, slides, options) {
      const notCurrent = [previous, next, ...rest]
      notCurrent.forEach(id =&gt; {
        if (pagers[id]) {
          pagers[id].classList.remove(options.classNames.active)
        }
      })
      if (pagers[current]) {
        pagers[current].classList.remove(options.classNames.active)
      }
      if (!options.loop &amp;&amp; prevTrigger &amp;&amp; nextTrigger) {
        if (current === 0) {
          prevTrigger.classList.add(options.classNames.disabled)
          nextTrigger.classList.remove(options.classNames.disabled)
        } else if (current === (slides.length - 1)) {
          nextTrigger.classList.add(options.classNames.disabled)
          prevTrigger.classList.remove(options.classNames.disabled)
        } else {
          prevTrigger.classList.remove(options.classNames.disabled)
          nextTrigger.classList.remove(options.classNames.disabled)
        }
      }
      block = false
      if (typeof opts.onEnd === &apos;function&apos;) {
        opts.onEnd({previous, next, current, rest}, {
          slides,
          captions,
          headlines,
          sublines,
          descriptions,
          pagers,
          dots,
          nextTrigger,
          prevTrigger
        }, options)
      }
    },
    onSlide(progress, {previous, next, current, rest}, slides, options) {
      if (typeof opts.onSlide === &apos;function&apos;) {
        opts.onSlide(progress, {previous, next, current, rest}, {
          slides,
          captions,
          headlines,
          sublines,
          descriptions,
          pagers,
          dots,
          nextTrigger,
          prevTrigger
        }, options)
      }
    },
    onDestroy(options) {
      draggables.forEach(draggable =&gt; {
        draggable.removeEventListener(&apos;dragstart&apos;, preventDefault)
      })
      pagers.forEach((pager, index) =&gt; {
        pager.removeEventListener(&apos;click&apos;, pagerHandlers[index])
      })
      document.removeEventListener(&apos;mouseup&apos;, handleMouseUp)
      if (nextTrigger) {
        nextTrigger.removeEventListener(&apos;click&apos;, handleNext)
      }
      if (prevTrigger) {
        prevTrigger.removeEventListener(&apos;click&apos;, handlePrev)
      }
      if (options.enableSwipe !== 0) {
        $(`.${options.classNames.slide}`, glider).forEach(el =&gt; {
          el.classList.remove(options.classNames.draggable)
          el.removeEventListener(&apos;mousedown&apos;, handleMouseDown)
        })
      }
      if (typeof opts.onDestroy === &apos;function&apos;) {
        opts.onDestroy(options)
      }
    }
  })
  if (instance) {
    instance.init(glider)
    return instance.destroy
  }
}

export default dataWrapper
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.5.2)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
